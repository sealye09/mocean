---
name: tdd
description: 测试驱动开发(TDD)指南，基于Kent Beck的《TDD By Example》。适用于：(1) 编写或规划代码测试，(2) 学习或应用TDD方法论，(3) 理解红-绿-重构等TDD模式和流程，(4) 创建测试框架或测试基础设施， (5) 在测试保护下进行重构，(6) 决定测试什么以及如何测试。涵盖TDD循环、核心模式（测试列表、测试先行、断言先行、红/绿/重构）、测试策略（隔离测试、测试数据、显式数据）和xUnit模式。
---

# 测试驱动开发 (TDD)

## 核心循环：红-绿-重构

```
1. 红   - 编写一个失败的测试
2. 绿   - 让测试通过（快速、简单）
3. 重构 - 消除重复
```

**核心理念**：TDD不是一定要用微小的步骤，而是**有能力**在需要时用微小的步骤。

## 快速开始

```
待办列表：
$5 + 10 CHF = $10，汇率2:1
$5 × 2 = $10
将amount设为私有
处理副作用？
```

1. **先写测试** - 想象完美的API接口
2. **让它编译** - 创建桩类、桩方法
3. **让它运行** - 假数据，硬编码返回值
4. **消除重复** - 消除测试与代码之间的依赖

## 参考指南

按主题组织的详细模式和示例：

| 主题 | 参考文档 |
|------|----------|
| TDD核心模式 | [core-patterns.md](references/core-patterns.md) |
| 编写测试 | [test-writing.md](references/test-writing.md) |
| 重构策略 | [refactoring.md](references/refactoring.md) |
| xUnit模式 | [xunit-patterns.md](references/xunit-patterns.md) |
| TDD中的设计模式 | [design-patterns.md](references/design-patterns.md) |

## 核心原则

### 测试先行
- 通过可预测的反馈降低压力
- 创建良性循环：更多测试 → 更少压力 → 更多测试
- 永远距离绿条只有一次改动

### 隔离测试
- 测试之间不能相互影响
- 执行顺序无关
- 强制高内聚、低耦合

### 断言先行
- 从断言开始，反向推导到设置代码
- 分离"正确答案是什么"与设计决策
- 自然地揭示API

### 测试列表
- 开始前列出所有需要的测试
- 实现过程中添加新发现的测试
- 团队协作时，离开前确保所有测试通过
